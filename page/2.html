<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Blog | Dina Berry</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://dfberry.github.io/page/2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Dina Berry"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="http://dfberry.github.io/page/2"><link data-rh="true" rel="alternate" href="http://dfberry.github.io/page/2" hreflang="en"><link data-rh="true" rel="alternate" href="http://dfberry.github.io/page/2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Dina Berry RSS feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Dina Berry RSS feed Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Dina Berry RSS feed JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2F4N5RRH1Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2F4N5RRH1Q",{})</script><link rel="stylesheet" href="/assets/css/styles.e17251aa.css">
<link rel="preload" href="/assets/js/runtime~main.17a6365c.js" as="script">
<link rel="preload" href="/assets/js/main.3c0508b7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Dina Berry</b></a><a class="navbar__item navbar__link" href="/docs">Introduction</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/">Blog</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/">Recent</a></li><li><a class="dropdown__link" href="/tags">Tags</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2024-04-06-code-includes.md">Examples of code includes for Dev.to</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2024-01-21-cloud-native-008-api-database.md">Add a database service to the API project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-12-28-cloud-native-006-client-todo.md">React Vite Client UI: quick Todo app proof of concept</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-12-10-deploy-from-github.md">Deploy to Azure from GitHub with Azure Developer CLI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-11-21-cloud-native-devops.md">Supercharging DevOps: Streamlining Cloud Infrastructure with Azure Developer CLI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-11-11-cloud-native-api.md">Embarking on a Cloud-native Journey with a Todo API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-11-03-cloud-native-002-developer-environment-setup">Cloud-native journey - developer environment setup</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-10-27-cloud-native-introduction">Cloud-native journey - introduction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-06-04-azure-openai-cli-with-typescript">Azure OpenAI Conversational CLI with TypeScript</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023-02-09-azure-cloud-shell-faq">Azure Cloud Shell Frequently asked questions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023.02.04-github-graphql-commit-history-with-typescript">TypeScript type guard for empty JSON object</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2023-12-10-deploy-from-github.md">Deploy to Azure from GitHub with Azure Developer CLI</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-10T00:00:00.000Z" itemprop="datePublished">December 10, 2023</time> · <!-- -->6 min read</div></header><div class="markdown" itemprop="articleBody"><p>This <a href="https://github.com/dfberry/cloud-native-todo/tree/005-deploy-from-github" target="_blank" rel="noopener noreferrer">fifth iteration</a> of the cloud-native project, <a href="https://github.com/dfberry/cloud-native-todo" target="_blank" rel="noopener noreferrer">https://github.com/dfberry/cloud-native-todo</a>, added the changes to deploy from the GitHub repository:</p><p><a href="https://youtu.be/CSZ6dMEkO4Q" target="_blank" rel="noopener noreferrer">YouTube demo</a></p><ol><li>Add <code>azure-dev.yml</code> GitHub action to deploy from source code</li><li>Run <code>azd pipeline config</code><ul><li>push action to repo</li><li>create Azure service principal with appropriate cloud permissions</li><li>create GitHub variables to connect to Azure service principal</li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h2><p>In the <a href="https://dev.to/dfberry/supercharging-devops-streamlining-cloud-infrastructure-with-azure-developer-cli-2o98" target="_blank" rel="noopener noreferrer">fourth iteration</a>, the project added the infrastructure as code (IaC), created with Azure Developer CLI with <code>azd init</code>. This created the <code>./azure.yml</code> file and the <code>./infra</code> folder. Using the infrastructure, the project was deployed with <code>azd up</code> from the local development environment (my local computer). That isn&#x27;t sustainable or desirable. Let&#x27;s change that so deployment happens from the source code repository.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-azure-devyml-github-action-to-deploy-from-source-repository">Add <code>azure-dev.yml</code> GitHub action to deploy from source repository<a href="#add-azure-devyml-github-action-to-deploy-from-source-repository" class="hash-link" aria-label="Direct link to add-azure-devyml-github-action-to-deploy-from-source-repository" title="Direct link to add-azure-devyml-github-action-to-deploy-from-source-repository">​</a></h2><p>The easiest way to find the correct <code>azure-dev.yml</code> is to use the official documentation to find the <a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/configure-devops-pipeline?tabs=GitHub" target="_blank" rel="noopener noreferrer">template</a> closest to your deployed resources and sample. </p><p><img loading="lazy" alt="Browser screenshot of the Azure Developer CLI template table by language and host" src="/assets/images/browser-azure-developer-cli-template-by-language-and-host-e1689a4311de639739374a70cece6999.png" width="1780" height="1340" class="img_ev3q"></p><ol><li><p>Copy the contents of the template&#x27;s <code>azure-dev.yml</code> file from the sample repository into your own source control in the <code>./github/workflows/azure-dev.yml</code> file. </p><p><img loading="lazy" alt="Browser screenshot of template source code azure-dev.yml" src="/assets/images/azure-dev-yml-e82a6d3dc82ff427ca895931806eaa09.png" width="1868" height="1340" class="img_ev3q"></p></li><li><p>Add the <strong>name</strong> to the top of the file if one isn&#x27;t there, such as <code>name: AZD Deploy</code>. This helps distinguish between other actions you have the in repository. </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name: AZD Deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workflow_dispatch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  push:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Run when commits are pushed to mainline branch (main or master)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Set this to the mainline branch you are using</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    branches:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make sure the <code>azure-dev.yml</code> also has the <code>workflow_dispatch</code> as one of the <code>on</code> settings. This allows you to deploy manually from GitHub. </p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-azd-pipeline-config-to-create-deployment-from-source-repository">Run <code>azd pipeline config</code> to create deployment from source repository<a href="#run-azd-pipeline-config-to-create-deployment-from-source-repository" class="hash-link" aria-label="Direct link to run-azd-pipeline-config-to-create-deployment-from-source-repository" title="Direct link to run-azd-pipeline-config-to-create-deployment-from-source-repository">​</a></h2><ol><li><p>Switch to a branch you intend to be used for deployment such as <code>main</code> or <code>dev</code>. The current branch name is used to create the federated credentials. </p></li><li><p>Run <code>azd pipeline config</code></p></li><li><p>If asked, log into your source control.</p></li><li><p>When the process is complete, copy the <strong>service principal</strong> name and id. Mine looked something like: </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az-dev-12-04-2023-18-11-29 (abc2c40c-b547-4dca-b591-1a4590963066)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you need to add new configurations, you&#x27;ll need to know either the name or ID to find it in the Microsoft Entra ID in the Azure portal.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-principal-for-secure-identity">Service principal for secure identity<a href="#service-principal-for-secure-identity" class="hash-link" aria-label="Direct link to Service principal for secure identity" title="Direct link to Service principal for secure identity">​</a></h2><p>The process created your service principal which is the identity used to deploy securely from GitHub to Azure. If you search for service principal in the Azure portal, it takes you Enterprise app. Don&#x27;t go there. An Enterprise app is meant for other people, like customers, to log in. That&#x27;s a different kind of thing. When you want to find your deployment service principal, search for <strong>Microsoft Entra ID</strong>. </p><ol><li><p>Go ahead ... find your service principal in the <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">Azure portal</a> by searching for <strong>Microsoft Entra ID</strong>. The service principals are listed under the <strong>Manage -&gt; App registrations -&gt; All applications</strong>. </p></li><li><p>Select your service principal. This takes you to the <strong>Default Directory | App registrations</strong>.</p></li><li><p>On the <strong>Manage -&gt; Certificates &amp; secrets</strong>, view the federated credentials. </p><p><img loading="lazy" alt="Browser screenshot of federated credentials" src="/assets/images/azure-portal-federated-credentials-967b7f6e0c9006773808e8c0bad965b3.png" width="1900" height="801" class="img_ev3q"></p></li><li><p>On the <strong>Manage -&gt; Roles and Administrators</strong>, view the <strong>Cloud Application Administrator</strong>. </p></li></ol><p>When you want to remove this service principal, you can come back to the portal, or use <a href="https://learn.microsoft.com/en-us/cli/azure/" target="_blank" rel="noopener noreferrer">Azure CLI</a>&#x27;s <code>az ad sp delete --id &lt;service-principal-id&gt;</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-action-variables-to-use-service-principal">GitHub action variables to use service principal<a href="#github-action-variables-to-use-service-principal" class="hash-link" aria-label="Direct link to GitHub action variables to use service principal" title="Direct link to GitHub action variables to use service principal">​</a></h2><p>The process added the service principal information to your GitHub repository as action variables. </p><ol><li><p>Open your GitHub repository in a browser and go to <strong>Settings</strong>.</p></li><li><p>Select <strong>Security -&gt; Secrets and variable -&gt; Actions</strong>.</p></li><li><p>Select variables to see the service principal variables. </p><p>![Browser screenshot of GitHub repository showing settings page with secure action variables table which lists the values necessary to deploy to Azure securely.]</p></li><li><p>Take a look at the actions run as part of the push from the process. The <strong>Build/Test</strong> action ran successfully when AZD pushed the new pipeline file in commit <a href="https://github.com/dfberry/cloud-native-todo/commit/24f78f4336e7bed72801a620176c04f0330b198e" target="_blank" rel="noopener noreferrer">24f78f4</a>. Look for the actions that run based on that commit. </p><p><img loading="lazy" alt="Browser screenshot of GitHub actions run with the commit" src="/assets/images/github-action-initial-deploy-action-edd41f93b7d1378d8acdc73ceaa10539.png" width="1906" height="410" class="img_ev3q"></p><p>Verify that the action ran successfully. Since this was the only change, the application should still have the <code>1.0.1</code> version number in the response from a root request. </p></li></ol><p>When you want to remove these, you can come back to your repo&#x27;s settings. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-a-deployment-from-source-repository-to-azure-with-azure-developer-cli">Test a deployment from source repository to Azure with Azure Developer CLI<a href="#test-a-deployment-from-source-repository-to-azure-with-azure-developer-cli" class="hash-link" aria-label="Direct link to Test a deployment from source repository to Azure with Azure Developer CLI" title="Direct link to Test a deployment from source repository to Azure with Azure Developer CLI">​</a></h2><p>To test the deployment, make a change and push to the repository. This can be in a branch you merge back into the default branch, or you can stay on the default branch to make the change and push. The important thing is that a push is made to the default branch to run the GitHub action.</p><p>In this project, a simple change to the API version in the <code>./api-todo/package.json</code>&#x27;s <strong>version</strong> property is enough of a change. And this change is reflected in the home route and the returned headers from an API call. </p><ol><li>Change the version from <code>1.0.1</code> to <code>1.0.2</code>.</li><li>Push the change to main. </li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="verify-deployment-from-source-repository-to-azure-with-azure-developer-cli">Verify deployment from source repository to Azure with Azure Developer CLI<a href="#verify-deployment-from-source-repository-to-azure-with-azure-developer-cli" class="hash-link" aria-label="Direct link to Verify deployment from source repository to Azure with Azure Developer CLI" title="Direct link to Verify deployment from source repository to Azure with Azure Developer CLI">​</a></h2><ol><li><p>Open the repository&#x27;s actions panel to see the action to deploy complete. </p><p><img loading="lazy" alt="Browser screenshot of actions run from version change and push" src="/assets/images/github-action-update-version-actions-8e206327342d65345bdd62fa182936ef.png" width="1906" height="292" class="img_ev3q"></p></li><li><p>Select the <strong>AZD Deploy</strong> for that commit to understand it is the same deployment as the local deployment. Continue to drill into the action until you see the individual steps.</p><p><img loading="lazy" alt="Browser screenshot of action steps for deploying from GitHub to Azure from Azure Developer CLI" src="/assets/images/github-action-azd-deploy-steps-successful-2d1ea573cc6a7ef03e994be33d8c8142.png" width="1906" height="932" class="img_ev3q"></p></li><li><p>Select the <strong>Deploy Application</strong> step and scroll to the bottom of that step. It shows the same deployed endpoint for the api-todo as the deployment from my local computer. </p><p><img loading="lazy" alt="Browser screenshot of Deploy Application step in GitHub action results" src="/assets/images/github-action-deploy-application-step-9ab186699bc85feaff05928d4aea827b.png" width="1906" height="976" class="img_ev3q"></p></li><li><p>Open the endpoint in a browser to see the updated version. </p><p><img loading="lazy" alt="Browser screenshot of updated application api-todo with new version number 1.0.2" src="/assets/images/browser-api-todo-app-version-update-3ee9cf07fda7abde78837cada1203ecd.png" width="1906" height="254" class="img_ev3q"></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-from-source-code-works">Deployment from source code works<a href="#deployment-from-source-code-works" class="hash-link" aria-label="Direct link to Deployment from source code works" title="Direct link to Deployment from source code works">​</a></h2><p>This application can now deploy the API app from source code with Azure Developer CLI. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tips">Tips<a href="#tips" class="hash-link" aria-label="Direct link to Tips" title="Direct link to Tips">​</a></h2><p>After some trial and error, here are the tips I would suggest for this process:</p><ul><li>Add a meaningful name to the <code>azure-dev.yml</code>. You will have several actions eventually, make sure the name of the deployment action is short and distinct. </li><li>Run <code>azd pipeline config</code> with the <code>--principal-name</code> switch in order to have a meaningful name. </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>This was an easy process for such an easy project. I&#x27;m interested to see how the infrastructure as code experience changes and the project changes.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/cloud-native">Cloud-native</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/deploy">Deploy</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure-developer-cli">Azure Developer CLI</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2023-11-21-cloud-native-devops.md">Supercharging DevOps: Streamlining Cloud Infrastructure with Azure Developer CLI</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-21T00:00:00.000Z" itemprop="datePublished">November 21, 2023</time> · <!-- -->10 min read</div></header><div class="markdown" itemprop="articleBody"><p>This <a href="https://github.com/dfberry/cloud-native-todo/tree/004-devops-azure" target="_blank" rel="noopener noreferrer">fourth iteration</a> of my cloud-native project, <a href="https://github.com/dfberry/cloud-native-todo" target="_blank" rel="noopener noreferrer">https://github.com/dfberry/cloud-native-todo</a>, added the steps of creating the cloud resources (provisioning) and pushing code to those resources (deployment). </p><p><img loading="lazy" alt="Diagram showing local and cloud areas with actions of provision and deployment between them." src="/assets/images/diagram-devops-actions-2a57da9f874038176306fc3beaaf5ff3.png" width="1906" height="960" class="img_ev3q"></p><p>For this cloud-native project, I knew there would be a Docker image of the project in a registry but I wasn&#x27;t sure of the fastest steps to create the image from the repository, push it to the registry or how it was pulled into the hosting environment. The authentication part to push to a registry and from which tool is usually what takes a minute or two. Anything that improved that auth flow would be welcome. </p><p>Sticking with tools I know to go as fast as possible, I used <a href="https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/" target="_blank" rel="noopener noreferrer">Azure Developer CLI</a> for the infrastructure. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-azure-developer-cli-as-a-dev-container-feature-in-visual-studio-code">Install Azure Developer CLI as a dev container feature in Visual Studio Code<a href="#install-azure-developer-cli-as-a-dev-container-feature-in-visual-studio-code" class="hash-link" aria-label="Direct link to Install Azure Developer CLI as a dev container feature in Visual Studio Code" title="Direct link to Install Azure Developer CLI as a dev container feature in Visual Studio Code">​</a></h2><p>Installation of Azure Developer CLI into dev containers is easy with a feature. <a href="https://containers.dev/features" target="_blank" rel="noopener noreferrer">Find the feature</a> and add it to the <code>./.devcontainer/devcontainer.json</code>. </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Features to add to the dev container. More info: https://containers.dev/features.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token property" style="color:#36acaa">&quot;features&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ghcr.io/azure/azure-dev/azd:latest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Use the Visual Studio Code command palette to select <strong>Dev Containers: Rebuild and reopen in container</strong>. Check the version of the Azure Developer CLI installed with the following command: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azd version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The response: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azd version </span><span class="token number" style="color:#36acaa">1.5</span><span class="token plain">.0 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">commit 012ae734904e0c376ce5074605a6d0d3f05789ee</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-infrastructure-code-with-azure-developer-cli">Create the infrastructure code with Azure Developer CLI<a href="#create-the-infrastructure-code-with-azure-developer-cli" class="hash-link" aria-label="Direct link to Create the infrastructure code with Azure Developer CLI" title="Direct link to Create the infrastructure code with Azure Developer CLI">​</a></h2><p>I&#x27;ve done most of this work before in other projects. I didn&#x27;t really expect to learn anything new. However, <a href="https://www.youtube.com/watch?v=NrQkdDVupQE&amp;list=PL0lo9MOBetEGF_pCQVCc_3z36ihKSolLC" target="_blank" rel="noopener noreferrer">GitHub Universe 2023</a> and <a href="https://www.youtube.com/watch?v=FZhbJZEgKQ4&amp;list=PLFPUGjQjckXE2cf8RBSjFYUUq8HkM_3zW" target="_blank" rel="noopener noreferrer">Microsoft Ignite 2023</a> both took place between <a href="https://dfberry.github.io/2023-11-11-cloud-native-api.md" target="_blank" rel="noopener noreferrer">iteration 003</a> and my start on this iteration, 004. While I still used <a href="https://docs.github.com/en/copilot" target="_blank" rel="noopener noreferrer">Copilot Chat</a> as my pair programming buddy, I also leaned into any new feature I heard of from these two industry conferences. The Azure Developer CLI&#x27;s <code>azd init</code> feature had an update (version 1.50) and I wanted to see what it would do. It asked Copilot Chat a couple of questions then it created the required files and folders. It took hours of Bicep development and compressed it into 30 seconds. Amazing!!!</p><p><img loading="lazy" alt="Screenshot of Visual Studio Code using azd init to create infrastructure of project." src="/assets/images/visual-studio-code-teminal-azd-init-b18b47d9582cc323d7c21bede9efa926.png" width="1676" height="804" class="img_ev3q"></p><p>Did it correctly configure the infrastructure for this project? Yes. When I add a second app to this project, further down the road, I&#x27;ll rerun <code>azd init</code> in a new branch. </p><p>The <code>azd init</code> process created a <code>./next-steps.md</code> which was a huge help in validation. </p><p><img loading="lazy" alt="Screenshot of Visual Studio Code displaying next steps file" src="/assets/images/visual-studio-code-next-steps-292f78d7689af9517a9059290256efba.png" width="310" height="211" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-cloud-resource-environment-variables-from-azure-developer-cli">Get cloud resource environment variables from Azure Developer CLI<a href="#get-cloud-resource-environment-variables-from-azure-developer-cli" class="hash-link" aria-label="Direct link to Get cloud resource environment variables from Azure Developer CLI" title="Direct link to Get cloud resource environment variables from Azure Developer CLI">​</a></h2><p>The <a href="https://github.com/dfberry/cloud-native-todo/blob/main/next-steps.md" target="_blank" rel="noopener noreferrer">next steps</a> covered environment variables because your project may need access to cloud resource secrets, connection strings, resource names, database names, and other settings created during provisioning to complete deployment tests. Azure Developer CLI gives you access this list of environment variables with <code>azd env get-values</code> to create your own <code>.env</code> file for your project. </p><p>I created a Bash script to get those values so I could test the endpoint.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Usage: &lt;script&gt; &lt;path-for-env-file&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example: ./scripts/postdeploy.sh &quot;./api-todo-test&quot; </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;postdeploy.sh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Getting param 1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ENV_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">/.env&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.env&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ENV_PATH: </span><span class="token string variable" style="color:#36acaa">$ENV_PATH</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Remove old .env file&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f </span><span class="token variable" style="color:#36acaa">$ENV_PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Getting values from azd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azd </span><span class="token function" style="color:#d73a49">env</span><span class="token plain"> get-values </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ENV_PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check if the .env exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> -f </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$ENV_PATH</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*** .env file not found at </span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Run the npm test command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Run test at </span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token builtin class-name">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Test completed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This script is called in the <code>./azure.yaml</code> file in the post deployment hook:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">postdeploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">shell</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        echo &quot;***** Root postdeploy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        ./scripts/postdeploy.sh &quot;./api-todo-test&quot;  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="develop-containers-for-cloud-native-apps">Develop containers for cloud-native apps<a href="#develop-containers-for-cloud-native-apps" class="hash-link" aria-label="Direct link to Develop containers for cloud-native apps" title="Direct link to Develop containers for cloud-native apps">​</a></h2><p>When I tried to use Azure Developer CLI to provision the project with <code>azd up</code>, the provision failed because the CLI couldn&#x27;t find the tools in the environment to build and push the image to the Azure Container Registy. </p><p><img loading="lazy" alt="Screenshot of Visual Studio Code terminal displaying result of azd up as docker tools are missing" src="/assets/images/visual-studio-code-terminal-docker-missing-902b761209a966829357c8cb454b9ed2.png" width="1848" height="350" class="img_ev3q"></p><p>While Docker isn&#x27;t specifically required to run Azure Developer CLI, it&#x27;s logical to assume if I intend to create images, I need the tools to do that. Copilot advised me to create a new <code>Dockerfile</code> for the dev container. This would have added another level of complexity and maintenance. Instead, I chose to use a dev container feature for <a href="https://github.com/devcontainers/features/tree/main/src/docker-in-docker" target="_blank" rel="noopener noreferrer">docker-in-docker</a> which leaves that complexity to the owner of the feature. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fix-for-dev-container-wont-start">Fix for dev container won&#x27;t start<a href="#fix-for-dev-container-wont-start" class="hash-link" aria-label="Direct link to Fix for dev container won&#x27;t start" title="Direct link to Fix for dev container won&#x27;t start">​</a></h2><p>I love Docker and I love dev containers but occasionally containers just don&#x27;t start and the error messages are so low-level that they generally aren&#x27;t helpful. The whole point of containers is that they consistently work but I develop on a Mac M1 and containers sometimes don&#x27;t work well with M1. </p><p>When I added the docker-in-docker feature to the Visual Studio dev container and rebuilt the container, the container wouldn&#x27;t start. I changed the configs and looked at the order of features, searched StackOverflow and GitHub and chatted with Copilot. Nothing helped. Using Visual Studio Code to rebuild the dev container without the cache didn&#x27;t fix it either. Which is when I knew it was my environment.</p><p>The fix was to stop the dev container, delete all containers, images, and volumes associated with the dev container and start over completely. I didn&#x27;t have any other projects in dev containers so I removed everything. </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Delete all containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">ps</span><span class="token variable" style="color:#36acaa"> -a -q</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Delete all images</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi -f </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> images -a -q</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Delete all volumes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> volume </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> volume </span><span class="token variable function" style="color:#d73a49">ls</span><span class="token variable" style="color:#36acaa"> -q</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-expressjs-container-image-to-azure">Deploy Express.js container image to Azure<a href="#deploy-expressjs-container-image-to-azure" class="hash-link" aria-label="Direct link to Deploy Express.js container image to Azure" title="Direct link to Deploy Express.js container image to Azure">​</a></h2><p>Restart the dev container and the dev container started. At this point, I tried to provision again with <code>azd up</code> (provision &amp; deploy) which succeeded. It&#x27;s impressive how the services just work together without me having to figure out how to pass integration information around. </p><p><img loading="lazy" alt="Screenshot of Visual Studio Code with successful deployment" src="/assets/images/visual-studio-code-terminal-azd-up-c24ceb48c2289c001206199dd9e9e29d.png" width="1906" height="978" class="img_ev3q"></p><p>Then I tried the endpoint for the API which is shown at the end of the output when <code>azd up</code> is done. I didn&#x27;t get my project from the endpoint. The &quot;Hello World&quot; for containers responded at the endpoint which meant provisioning worked but deployment failed. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="find-container-image-deployment-error-in-azure-portal-deployment-log">Find container image deployment error in Azure portal deployment log<a href="#find-container-image-deployment-error-in-azure-portal-deployment-log" class="hash-link" aria-label="Direct link to Find container image deployment error in Azure portal deployment log" title="Direct link to Find container image deployment error in Azure portal deployment log">​</a></h2><p>The Azure resource group, the logical unit for all the resources in the infrastructure, has a deployment log. The Container App showed a failed status. The code is still a very simple Express.js app so the issue had to also be simple. I checked the deployment logs in the Azure portal and found the app&#x27;s start script pointed to the wrong file. </p><p><img loading="lazy" alt="Azure portal Container App deployment revision error" src="/assets/images/azure-portal-failed-deployment-9ec0cec2ad1f3a5000b578620d8bc522.png" width="1906" height="696" class="img_ev3q"></p><p>Following the error to the log shows the issue that the start file is incorrect.</p><p><img loading="lazy" alt="Azure portal Container App logs" src="/assets/images/azure-portal-log-container-fail-6d31cd3810b66995ef6247bd4fbea549.png" width="1906" height="956" class="img_ev3q"></p><p>A quick fix to the Dockerfile.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Wrong cmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pm2-runtime&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;start&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;server.js&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Correct cmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pm2-runtime&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;start&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dist/start.js&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then <code>azd up</code> and the correct endpoint worked. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-version-header-to-source-code">Add a version header to source code<a href="#add-a-version-header-to-source-code" class="hash-link" aria-label="Direct link to Add a version header to source code" title="Direct link to Add a version header to source code">​</a></h2><p>While testing the deployment, I wanted to add versioning to the app so I knew changes to the project were displayed at the endpoint. The root request returns the version found in the <code>./api-todo/package.json</code>, and the APIs return a <code>x-api-version</code> header with the value. </p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// eslint-disable-next-line @typescript-eslint/ban-ts-comment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// @ts-ignore: Ignoring TS6059 as we want to import version from package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> version </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;../../package.json&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setVersionHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;x-api-version&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <strong>curl</strong> request returns the header when using <code>--verbose</code>.</p><p><img loading="lazy" alt="Visual Studio code terminal with curl request showing x-api-version header displaying version 1.0.1" src="/assets/images/visual-studio-code-curl-request-5a834f3fa60c1917ab4b916092f0e03e.png" width="1906" height="1066" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-playwright-test-to-validate-api">Add Playwright test to validate API<a href="#add-playwright-test-to-validate-api" class="hash-link" aria-label="Direct link to Add Playwright test to validate API" title="Direct link to Add Playwright test to validate API">​</a></h2><p>When I added playwright to the dev container and rebuilt the dev container, the container started but Playwright and its dependencies took up too much room. I increased the size of my container and limited by testing to Chrome. I also added the installation in the <code>./.devcontainer/post-create-command.sh</code> script. By adding the installation here, when the container opens, I can see if it has enough room for a big dependency like Playwright and its browsers. </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ./.devcontainer/post-create-command.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#! /bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i -g npm@latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> -R +x ./scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx playwright </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --with-deps </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Node version&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NPM version&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Git version&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Docker version&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> --version </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Playwright for the API tests the new header and the returned array of todos.</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> expect </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@playwright/test&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dotenv </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dotenv&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotenv</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">API_TODO_URL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:3000&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;API_URL&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_URL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> version </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;../../api-todo/package.json&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ignoreHTTPSErrors</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// in case your certificate isn&#x27;t properly signed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  baseURL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">API_URL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extraHTTPHeaders</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&#x27;Accept&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;application/vnd.github.v3+json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Add authorization token to all requests.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&#x27;Authorization&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">token </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">process</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">env</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation constant" style="color:#36acaa">API_TOKEN</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;should get all todos&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> request </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/todo</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toBeTruthy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Validate the x-api-version header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">headers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toHaveProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;x-api-version&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;x-api-version&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Validate the response body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> todos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toBeTruthy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todos</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run the test from the workspace with <code>npm run test --workspace=api-todo-test</code> and see the test succeeded. </p><p><img loading="lazy" alt="Screenshot of Visual Studio Code terminal with Playwright test results" src="/assets/images/visual-studio-code-terminal-playwright-results-a10908e7d446d5daeb6fca0a3cba5aa8.png" width="1384" height="732" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="most-fun---time-savings">Most fun - time savings<a href="#most-fun---time-savings" class="hash-link" aria-label="Direct link to Most fun - time savings" title="Direct link to Most fun - time savings">​</a></h2><p>The best part about this project is the tooling. I can spend less time and enjoy that time more. </p><p><img loading="lazy" alt="Cartoonish image of a clock" src="/assets/images/time-savings-4460bad9823a94a35ba04e8756caf092.jpg" width="250" height="250" class="img_ev3q"></p><p>Currently Copilot shines with technologies that have a lot of Internet coverage including docs and troubleshooting. For this particular iteration, the only place Copilot didn&#x27;t help was the annoying Docker issue when the dev container wouldn&#x27;t start after adding the docker-in-docker dev container feature. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wish-list-item-1---azd-test">Wish list item #1 - <code>azd test</code><a href="#wish-list-item-1---azd-test" class="hash-link" aria-label="Direct link to wish-list-item-1---azd-test" title="Direct link to wish-list-item-1---azd-test">​</a></h2><p>While Azure Developer CLI provided provisioning and deployment, it didn&#x27;t add testing. This seems like a natural next step for the project. It knows what the stack is because it created the infrastructure to support it. And it knows the endpoints because it displays them at the end of the deployment. Adding API tests seems within the tool&#x27;s ability someday.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wist-list-item-2---docker-in-docker">Wist list item #2 - docker-in-docker<a href="#wist-list-item-2---docker-in-docker" class="hash-link" aria-label="Direct link to Wist list item #2 - docker-in-docker" title="Direct link to Wist list item #2 - docker-in-docker">​</a></h2><p>Since the infrastructure required containers and the environment had the <code>.devcontainer</code> folder, adding docker-in-docker as a dev container feature is probably something Azure Developer CLI can fix in the future...perhaps a YAML snippet for the dev container feature in the <code>./next-steps.md</code>:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">&quot;features&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ghcr.io/azure/azure-dev/azd:latest&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ghcr.io/devcontainers/features/docker-in-docker:1&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tips">Tips<a href="#tips" class="hash-link" aria-label="Direct link to Tips" title="Direct link to Tips">​</a></h2><p>There were a few things I found useful that I use moving forward in my development in the <a href="https://github.com/dfberry/cloud-native-todo" target="_blank" rel="noopener noreferrer">Tips list</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="results-for-004---create-resources-and-deploy-code">Results for 004 - create resources and deploy code<a href="#results-for-004---create-resources-and-deploy-code" class="hash-link" aria-label="Direct link to Results for 004 - create resources and deploy code" title="Direct link to Results for 004 - create resources and deploy code">​</a></h2><p>Once again Copilot saved a lot of time but it took backseat to the amazing work Azure Developer CLI provided with the entire DevOps flow. And notice there wasn&#x27;t any auth flow for the Container registry to deal with when pushing images. That was all wrapped up in the Azure Developer CLI auth. Another time saver.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/cloud-native">Cloud-native</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/dev-ops">DevOps</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure-developer-cli">Azure Developer CLI</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/playwright">Playwright</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2023-11-11-cloud-native-api.md">Embarking on a Cloud-native Journey with a Todo API</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-10T00:00:00.000Z" itemprop="datePublished">November 10, 2023</time> · <!-- -->4 min read</div></header><div class="markdown" itemprop="articleBody"><p>Our cloud-native adventure begins with the API layer - the magical bridge between the front-end UI and the back-end services. For our Todo project, we&#x27;re keeping the API simple and efficient. Express.js is our chosen framework, a tried-and-true Node.js project. With the power of Copilot Chat, we&#x27;ll be speeding through the process in no time!</p><p><a href="https://bit.ly/3SBV3zx" target="_blank" rel="noopener noreferrer">How do you typically approach building a new API for a cloud-native project?</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fire-up-the-dev-container">Fire Up the Dev Container<a href="#fire-up-the-dev-container" class="hash-link" aria-label="Direct link to Fire Up the Dev Container" title="Direct link to Fire Up the Dev Container">​</a></h2><p>In the previous chapter of our journey, <a href="https://github.com/dfberry/cloud-native-todo/tree/002-developer-environment-setup" target="_blank" rel="noopener noreferrer">002-developer-environment-setup</a>, we set up a robust dev environment. Now, it&#x27;s time to bring it to life! Open it in GitHub Codespaces or locally on your computer with Visual Studio Code (Docker installation required). </p><p>Whether you&#x27;re the lead developer or part of a team, whether you&#x27;re working on a familiar project or exploring new territories, you&#x27;ve got options. Visual Studio Code and the dev container for local work, or Codespaces for a cloud-based approach.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="stay-in-the-dev-container">Stay in the dev container<a href="#stay-in-the-dev-container" class="hash-link" aria-label="Direct link to Stay in the dev container" title="Direct link to Stay in the dev container">​</a></h2><p>If you are like me, your local computer may not be a workhorse so docker may not be started when you start working on your project. You can start using Copilot chap locally, then realize you need the dev container for something. The Copilot chat stays with the environment, it doesn&#x27;t move (at this time). If you are 20 questions into your conversation with a few side trips here and there, switching environments and not having the chat to reference is frustrating. </p><p>If you are using dev containers and Copilot chat, start and stay in the container for the entire conversation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-an-api-with-copilot-chat">Building an API with Copilot Chat<a href="#building-an-api-with-copilot-chat" class="hash-link" aria-label="Direct link to Building an API with Copilot Chat" title="Direct link to Building an API with Copilot Chat">​</a></h2><p>In just half an hour, Copilot Chat helped me create a fully functional API, complete with types, linting, tests, and a build-test workflow. Here&#x27;s a sneak peek into the prompts I used:</p><ol><li>Building a todo microservice with Node.js and TypeScript.</li><li>Adding tests for the todo API.</li><li>Refactoring server.ts for both server and test.</li><li>Modifying server.ts for CRUD operations.</li><li>Providing initial sample data.</li><li>Creating an OpenAPI yaml for the API.</li><li>Adding an OpenAPI UI route.</li><li>Setting up ESLint with Prettier.</li><li>Deciding .gitignore contents.</li><li>Moving openapi.yaml to the dist folder using tsc.</li><li>Creating a GitHub action for linting, building, and testing.</li><li>Identifying missing microservice elements.</li><li>Adding type safety.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="refining-types-and-refactoring">Refining Types and Refactoring<a href="#refining-types-and-refactoring" class="hash-link" aria-label="Direct link to Refining Types and Refactoring" title="Direct link to Refining Types and Refactoring">​</a></h2><p>There was some back-and-forth over types and refactoring. Copilot shone in evaluating incoming API request data. After a few prompts, the validation looked like this:</p><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Todo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">PartialTodo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> todoSchema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Joi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Joi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">greater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">required</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Joi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">required</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unknown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> todoPartialSchema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Joi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Joi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">greater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Joi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">required</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unknown</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">TodoValidation</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  valid</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  error</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Error </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ValidationErrorItem</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  todo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Todo </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> PartialTodo </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> validateTodo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  todo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PartialTodo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  isNewTodo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> TodoValidation </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> schema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> isNewTodo </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> todoPartialSchema </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> todoSchema</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> error </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">todo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      valid</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      error</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">details</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      todo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> valid</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> todo </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Copilot also excelled in creating logging handlers for requests and responses, and in adding those handlers to the route.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="copilots-strengths">Copilot&#x27;s Strengths<a href="#copilots-strengths" class="hash-link" aria-label="Direct link to Copilot&#x27;s Strengths" title="Direct link to Copilot&#x27;s Strengths">​</a></h2><p>Copilot gave me a flying start. While some answers lacked details, running the app or tests quickly revealed any errors, which were easy to fix.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="copilots-weaknesses">Copilot&#x27;s Weaknesses<a href="#copilots-weaknesses" class="hash-link" aria-label="Direct link to Copilot&#x27;s Weaknesses" title="Direct link to Copilot&#x27;s Weaknesses">​</a></h2><p>Despite the conversation and the wealth of examples, I encountered more issues than expected. For more obscure subjects, I&#x27;d recommend breaking down the steps more atomically.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-not-use-existing-code">Why Not Use Existing Code?<a href="#why-not-use-existing-code" class="hash-link" aria-label="Direct link to Why Not Use Existing Code?" title="Direct link to Why Not Use Existing Code?">​</a></h2><p>Sure, there are plenty of examples on GitHub. But navigating licenses and attributions can be tricky. I preferred to avoid any potential missteps.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="time-investment">Time Investment<a href="#time-investment" class="hash-link" aria-label="Direct link to Time Investment" title="Direct link to Time Investment">​</a></h2><p>From start to finish, the project took about 2 hours. There were a few hiccups along the way, but each step was small, making issues manageable. Considering everything, 2 hours is a solid benchmark for a proof-of-concept project.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/cloud-native">Cloud-native</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/ai-assisted">AI assisted</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/todo">todo</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/api">api</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/3"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Development</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/dfberry" target="_blank" rel="noopener noreferrer" class="footer__link-item">dfberry (personal)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/diberry" target="_blank" rel="noopener noreferrer" class="footer__link-item">diberry (Microsoft)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Developer content</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dfberry.github.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@DFBerry-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Video<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/presentations">Presentations</a></li><li class="footer__item"><a href="http://www.31a2ba2a-b718-11dc-8314-0800200c9a66.com/search/label/Dina" target="_blank" rel="noopener noreferrer" class="footer__link-item">Archive - Project 31a<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://learn.microsoft.com/en-us/azure/developer/javascript/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Microsoft<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/dina-berry-1297a38" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Dina Berry.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.17a6365c.js"></script>
<script src="/assets/js/main.3c0508b7.js"></script>
</body>
</html>